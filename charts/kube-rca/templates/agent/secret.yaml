{{- $gemini := default (dict) .Values.agent.gemini -}}
{{- $geminiSecret := default (dict) $gemini.secret -}}
{{- $geminiCreate := default true $geminiSecret.create -}}
{{- $geminiExisting := default "" $geminiSecret.existingSecret -}}
{{- if and $geminiCreate (eq $geminiExisting "") -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kube-rca.agent.geminiSecretName" . }}
  labels:
    {{- include "kube-rca.agent.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{ default "api-key" $geminiSecret.key | quote }}: ""
{{- end }}

{{- $openai := default (dict) .Values.agent.openai -}}
{{- $openaiSecret := default (dict) $openai.secret -}}
{{- $openaiCreate := default false $openaiSecret.create -}}
{{- $openaiExisting := default "" $openaiSecret.existingSecret -}}
{{- if and $openaiCreate (eq $openaiExisting "") -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kube-rca.agent.openaiSecretName" . }}
  labels:
    {{- include "kube-rca.agent.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{ default "api-key" $openaiSecret.key | quote }}: ""
{{- end }}

{{- $anthropic := default (dict) .Values.agent.anthropic -}}
{{- $anthropicSecret := default (dict) $anthropic.secret -}}
{{- $anthropicCreate := default false $anthropicSecret.create -}}
{{- $anthropicExisting := default "" $anthropicSecret.existingSecret -}}
{{- if and $anthropicCreate (eq $anthropicExisting "") -}}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kube-rca.agent.anthropicSecretName" . }}
  labels:
    {{- include "kube-rca.agent.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{ default "api-key" $anthropicSecret.key | quote }}: ""
{{- end }}
